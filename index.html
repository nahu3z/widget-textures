<!DOCTYPE html>
<html>
<head>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; background: transparent; }
        
        #atlas { 
            display: flex; 
            flex-direction: row; 
            height: 100vh; 
            width: max-content; 
        }
        
        .gif-container {
            position: relative;
            height: 100vh;
            display: flex;
        }

        .pixel-marker {
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 1px;
            z-index: 10;
            background-color: transparent;
        }

        img { 
            height: 100vh;
            width: auto; 
            display: block; 
        }
    </style>
</head>
<body>
    <div id="atlas"></div>
    <script>
        const container = document.getElementById('atlas');

        window.addEventListener("hashchange", () => {
            const data = location.hash.substring(1).split(',');
            if (data[0] === "add") {
                addGif(decodeURIComponent(data[1]), data[2]);
            } else if (data[0] === "remove") {
                const el = document.getElementById("cont-" + data[1]);
                if (el) el.remove();
            }
            location.hash = "";
        });

        function addGif(url, id) {
            const wrapper = document.createElement('div');
            wrapper.className = "gif-container";
            wrapper.id = "cont-" + id;

            const pixel = document.createElement('div');
            pixel.className = "pixel-marker";

            const img = document.createElement('img');
            const renderH = window.innerHeight;
            img.src = `https://wsrv.nl/?url=${encodeURIComponent(url)}&h=${renderH}&output=webp&n=-1`;
            
            img.onload = () => {
                const width = img.clientWidth;
                const numericId = parseInt(id) % 256;

                const r = width % 256;
                const g = Math.floor(width / 256);
                const b = numericId;

                pixel.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                
                wrapper.appendChild(pixel);
                wrapper.appendChild(img);
                container.appendChild(wrapper);
            };
        }
    </script>
</body>
</html>
